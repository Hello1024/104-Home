<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="heatingstyle.css">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<link rel="preconnect" href="https://fonts.gstatic.com">
		<link rel="manifest" href="manifest.json">
		<link href="https://fonts.googleapis.com/css2?family=Akronim&family=Creepster&family=Frijole&family=Henny+Penny&family=Nosifer&display=swap" rel="stylesheet">
		<link rel="apple-touch-icon" href="icon-512x512.png">
	</head>
	<body>
		<canvas id="canvas" width=150>
			
		</canvas>
		
		<div id=infront>
			<button class="hotter centered">More Hot</button>
			<h1 class="nownumber"><span id='now'>&#x1F937;</span></h1> 
			<p class="nextnumber">Going to:<span id='target'>&#x1F937;</span></p>
			<button class="colder centered">More Cold</button>
		</div>
		
		<div class="lds-dual-ring loader"></div>
		
		<script src=heatingmovement.js></script>
		<script>
			async function myfetch(url) {
				document.querySelector('.loader').style.display = 'none';
				a = await fetch('https://api.allorigins.win/raw?url=http://104.omattos.com:19891/' + url + '?'+Date.now());
				document.querySelector('.loader').style.display = 'block';
				return a;
			}
			async function updateTemp() {
			  var res = await myfetch('temp');
                          var json = await res.json();
			  document.querySelector("#now").innerText = json.hallTemperature;
			  document.querySelector("#target").innerText = json.targetHallTemperature;
			  if (json.isHeatingNow)
			    document.querySelector('canvas').style.backgroundImage = 'linear-gradient(180deg, rgb(255,103,105) 0%, rgb(195,42,23) 84%)';
			  else
			    document.querySelector('canvas').style.backgroundImage = 'linear-gradient(180deg, rgb(105,173,212) 0%, rgb(23,82,145) 84%)';
			  
			}
			
			updateTemp();
			
			async function hotter() {
				await myfetch('hotter');
				updateTemp();
			}
			
			async function colder() {
				await myfetch('colder');
				updateTemp();
			}
			document.querySelector("button.colder").addEventListener('click', colder);
			document.querySelector("button.hotter").addEventListener('click', hotter);
		</script>
	</body>
</html>
